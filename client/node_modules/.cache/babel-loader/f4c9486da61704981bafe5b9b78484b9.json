{"ast":null,"code":"'use strict';\n/*\n * Engines which do not support caching of their file contents\n * should use the `read()` function defined in consolidate.js\n * On top of this, when an engine compiles to a `Function`,\n * these functions should either be cached within consolidate.js\n * or the engine itself via `options.cache`. This will allow\n * users and frameworks to pass `options.cache = true` for\n * `NODE_ENV=production`, however edit the file(s) without\n * re-loading the application in development.\n */\n\n/**\n * Module dependencies.\n */\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar Promise = require('bluebird');\n\nvar join = path.join;\nvar resolve = path.resolve;\nvar extname = path.extname;\nvar dirname = path.dirname;\nvar isAbsolute = path.isAbsolute;\nvar readCache = {};\n/**\n * Require cache.\n */\n\nvar cacheStore = {};\n/**\n * Require cache.\n */\n\nvar requires = {};\n/**\n * Clear the cache.\n *\n * @api public\n */\n\nexports.clearCache = function () {\n  readCache = {};\n  cacheStore = {};\n};\n/**\n * Conditionally cache `compiled` template based\n * on the `options` filename and `.cache` boolean.\n *\n * @param {Object} options\n * @param {Function} compiled\n * @return {Function}\n * @api private\n */\n\n\nfunction cache(options, compiled) {\n  // cachable\n  if (compiled && options.filename && options.cache) {\n    delete readCache[options.filename];\n    cacheStore[options.filename] = compiled;\n    return compiled;\n  } // check cache\n\n\n  if (options.filename && options.cache) {\n    return cacheStore[options.filename];\n  }\n\n  return compiled;\n}\n/**\n * Read `path` with `options` with\n * callback `(err, str)`. When `options.cache`\n * is true the template string will be cached.\n *\n * @param {String} options\n * @param {Function} cb\n * @api private\n */\n\n\nfunction read(path, options, cb) {\n  var str = readCache[path];\n  var cached = options.cache && str && typeof str === 'string'; // cached (only if cached is a string and not a compiled template function)\n\n  if (cached) return cb(null, str); // read\n\n  fs.readFile(path, 'utf8', function (err, str) {\n    if (err) return cb(err); // remove extraneous utf8 BOM marker\n\n    str = str.replace(/^\\uFEFF/, '');\n    if (options.cache) readCache[path] = str;\n    cb(null, str);\n  });\n}\n/**\n * Read `path` with `options` with\n * callback `(err, str)`. When `options.cache`\n * is true the partial string will be cached.\n *\n * @param {String} options\n * @param {Function} fn\n * @api private\n */\n\n\nfunction readPartials(path, options, cb) {\n  if (!options.partials) return cb();\n  var keys = Object.keys(options.partials);\n  var partials = {};\n\n  function next(index) {\n    if (index === keys.length) return cb(null, partials);\n    var key = keys[index];\n    var partialPath = options.partials[key];\n\n    if (partialPath === undefined || partialPath === null || partialPath === false) {\n      return next(++index);\n    }\n\n    var file;\n\n    if (isAbsolute(partialPath)) {\n      if (extname(partialPath) !== '') {\n        file = partialPath;\n      } else {\n        file = join(partialPath + extname(path));\n      }\n    } else {\n      file = join(dirname(path), partialPath + extname(path));\n    }\n\n    read(file, options, function (err, str) {\n      if (err) return cb(err);\n      partials[key] = str;\n      next(++index);\n    });\n  }\n\n  next(0);\n}\n/**\n * promisify\n */\n\n\nfunction promisify(cb, fn) {\n  return new Promise(function (resolve, reject) {\n    cb = cb || function (err, html) {\n      if (err) {\n        return reject(err);\n      }\n\n      resolve(html);\n    };\n\n    fn(cb);\n  });\n}\n/**\n * fromStringRenderer\n */\n\n\nfunction fromStringRenderer(name) {\n  return function (path, options, cb) {\n    options.filename = path;\n    return promisify(cb, function (cb) {\n      readPartials(path, options, function (err, partials) {\n        var extend = requires.extend || (requires.extend = require('util')._extend);\n\n        var opts = extend({}, options);\n        opts.partials = partials;\n        if (err) return cb(err);\n\n        if (cache(opts)) {\n          exports[name].render('', opts, cb);\n        } else {\n          read(path, opts, function (err, str) {\n            if (err) return cb(err);\n            exports[name].render(str, opts, cb);\n          });\n        }\n      });\n    });\n  };\n}\n/**\n * velocity support.\n */\n\n\nexports.velocityjs = fromStringRenderer('velocityjs');\n/**\n * velocity string support.\n */\n\nexports.velocityjs.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.velocityjs || (requires.velocityjs = require('velocityjs'));\n\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Liquid support.\n */\n\n\nexports.liquid = fromStringRenderer('liquid');\n/**\n * Liquid string support.\n */\n\n/**\n * Note that in order to get filters and custom tags we've had to push\n * all user-defined locals down into @locals. However, just to make things\n * backwards-compatible, any property of `options` that is left after\n * processing and removing `locals`, `meta`, `filters`, `customTags` and\n * `includeDir` will also become a local.\n */\n\nfunction _renderTinyliquid(engine, str, options, cb) {\n  var context = engine.newContext();\n  var k;\n  /**\n   * Note that there's a bug in the library that doesn't allow us to pass\n   * the locals to newContext(), hence looping through the keys:\n   */\n\n  if (options.locals) {\n    for (k in options.locals) {\n      context.setLocals(k, options.locals[k]);\n    }\n\n    delete options.locals;\n  }\n\n  if (options.meta) {\n    context.setLocals('page', options.meta);\n    delete options.meta;\n  }\n  /**\n   * Add any defined filters:\n   */\n\n\n  if (options.filters) {\n    for (k in options.filters) {\n      context.setFilter(k, options.filters[k]);\n    }\n\n    delete options.filters;\n  }\n  /**\n   * Set up a callback for the include directory:\n   */\n\n\n  var includeDir = options.includeDir || process.cwd();\n  context.onInclude(function (name, callback) {\n    var extname = path.extname(name) ? '' : '.liquid';\n    var filename = path.resolve(includeDir, name + extname);\n    fs.readFile(filename, {\n      encoding: 'utf8'\n    }, function (err, data) {\n      if (err) return callback(err);\n      callback(null, engine.parse(data));\n    });\n  });\n  delete options.includeDir;\n  /**\n   * The custom tag functions need to have their results pushed back\n   * through the parser, so set up a shim before calling the provided\n   * callback:\n   */\n\n  var compileOptions = {\n    customTags: {}\n  };\n\n  if (options.customTags) {\n    var tagFunctions = options.customTags;\n\n    for (k in options.customTags) {\n      /*Tell jshint there's no problem with having this function in the loop */\n\n      /*jshint -W083 */\n      compileOptions.customTags[k] = function (context, name, body) {\n        var tpl = tagFunctions[name](body.trim());\n        context.astStack.push(engine.parse(tpl));\n      };\n      /*jshint +W083 */\n\n    }\n\n    delete options.customTags;\n  }\n  /**\n   * Now anything left in `options` becomes a local:\n   */\n\n\n  for (k in options) {\n    context.setLocals(k, options[k]);\n  }\n  /**\n   * Finally, execute the template:\n   */\n\n\n  var tmpl = cache(context) || cache(context, engine.compile(str, compileOptions));\n  tmpl(context, cb);\n}\n\nexports.liquid.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.liquid;\n    var Liquid;\n\n    try {\n      // set up tinyliquid engine\n      engine = requires.liquid = require('tinyliquid'); // use tinyliquid engine\n\n      _renderTinyliquid(engine, str, options, cb);\n\n      return;\n    } catch (err) {\n      // set up liquid-node engine\n      try {\n        Liquid = requires.liquid = require('liquid-node');\n        engine = new Liquid.Engine();\n      } catch (err) {\n        throw err;\n      }\n    } // use liquid-node engine\n\n\n    try {\n      var locals = options.locals || {};\n\n      if (options.meta) {\n        locals.pages = options.meta;\n        delete options.meta;\n      }\n      /**\n       * Add any defined filters:\n       */\n\n\n      if (options.filters) {\n        engine.registerFilters(options.filters);\n        delete options.filters;\n      }\n      /**\n       * Set up a callback for the include directory:\n       */\n\n\n      var includeDir = options.includeDir || process.cwd();\n      engine.fileSystem = new Liquid.LocalFileSystem(includeDir, 'liquid');\n      delete options.includeDir;\n      /**\n       * The custom tag functions need to have their results pushed back\n       * through the parser, so set up a shim before calling the provided\n       * callback:\n       */\n\n      if (options.customTags) {\n        var tagFunctions = options.customTags;\n\n        for (k in options.customTags) {\n          engine.registerTag(k, tagFunctions[k]);\n        }\n\n        delete options.customTags;\n      }\n      /**\n       * Now anything left in `options` becomes a local:\n       */\n\n\n      for (var k in options) {\n        locals[k] = options[k];\n      }\n      /**\n       * Finally, execute the template:\n       */\n\n\n      return engine.parseAndRender(str, locals).nodeify(function (err, result) {\n        if (err) {\n          throw new Error(err);\n        } else {\n          return cb(null, result);\n        }\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Jade support.\n */\n\n\nexports.jade = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.jade;\n\n    if (!engine) {\n      try {\n        engine = requires.jade = require('jade');\n      } catch (err) {\n        try {\n          engine = requires.jade = require('then-jade');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compileFile(path, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Jade string support.\n */\n\n\nexports.jade.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.jade;\n\n    if (!engine) {\n      try {\n        engine = requires.jade = require('jade');\n      } catch (err) {\n        try {\n          engine = requires.jade = require('then-jade');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Dust support.\n */\n\n\nexports.dust = fromStringRenderer('dust');\n/**\n * Dust string support.\n */\n\nexports.dust.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.dust;\n\n    if (!engine) {\n      try {\n        engine = requires.dust = require('dust');\n      } catch (err) {\n        try {\n          engine = requires.dust = require('dustjs-helpers');\n        } catch (err) {\n          engine = requires.dust = require('dustjs-linkedin');\n        }\n      }\n    }\n\n    var ext = 'dust';\n    var views = '.';\n\n    if (options) {\n      if (options.ext) ext = options.ext;\n      if (options.views) views = options.views;\n      if (options.settings && options.settings.views) views = options.settings.views;\n    }\n\n    if (!options || options && !options.cache) engine.cache = {};\n\n    engine.onLoad = function (path, callback) {\n      if (extname(path) === '') path += '.' + ext;\n      if (path[0] !== '/') path = views + '/' + path;\n      read(path, options, callback);\n    };\n\n    try {\n      var templateName;\n\n      if (options.filename) {\n        templateName = options.filename.replace(new RegExp('^' + views + '/'), '').replace(new RegExp('\\\\.' + ext), '');\n      }\n\n      var tmpl = cache(options) || cache(options, engine.compileFn(str, templateName));\n      tmpl(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Swig support.\n */\n\n\nexports.swig = fromStringRenderer('swig');\n/**\n * Swig string support.\n */\n\nexports.swig.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.swig;\n\n    if (!engine) {\n      try {\n        engine = requires.swig = require('swig');\n      } catch (err) {\n        try {\n          engine = requires.swig = require('swig-templates');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      if (options.cache === true) options.cache = 'memory';\n      engine.setDefaults({\n        cache: options.cache\n      });\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Razor support.\n */\n\n\nexports.razor = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.razor;\n\n    if (!engine) {\n      try {\n        engine = requires.razor = require('razor-tmpl');\n      } catch (err) {\n        throw err;\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, locals => {\n        console.log('Rendering razor file', path);\n        return engine.renderFileSync(path, locals);\n      });\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * razor string support.\n */\n\n\nexports.razor.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    try {\n      var engine = requires.razor = require('razor-tmpl');\n    } catch (err) {\n      throw err;\n    }\n\n    try {\n      var tf = engine.compile(str);\n      var tmpl = cache(options) || cache(options, tf);\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Atpl support.\n */\n\n\nexports.atpl = fromStringRenderer('atpl');\n/**\n * Atpl string support.\n */\n\nexports.atpl.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.atpl || (requires.atpl = require('atpl'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Liquor support,\n */\n\n\nexports.liquor = fromStringRenderer('liquor');\n/**\n * Liquor string support.\n */\n\nexports.liquor.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.liquor || (requires.liquor = require('liquor'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Twig support.\n */\n\n\nexports.twig = fromStringRenderer('twig');\n/**\n * Twig string support.\n */\n\nexports.twig.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.twig || (requires.twig = require('twig').twig);\n\n    var templateData = {\n      data: str,\n      allowInlineIncludes: options.allowInlineIncludes,\n      namespaces: options.namespaces,\n      path: options.path\n    };\n\n    try {\n      var tmpl = cache(templateData) || cache(templateData, engine(templateData));\n      cb(null, tmpl.render(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * EJS support.\n */\n\n\nexports.ejs = fromStringRenderer('ejs');\n/**\n * EJS string support.\n */\n\nexports.ejs.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.ejs || (requires.ejs = require('ejs'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Eco support.\n */\n\n\nexports.eco = fromStringRenderer('eco');\n/**\n * Eco string support.\n */\n\nexports.eco.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.eco || (requires.eco = require('eco'));\n\n    try {\n      cb(null, engine.render(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Jazz support.\n */\n\n\nexports.jazz = fromStringRenderer('jazz');\n/**\n * Jazz string support.\n */\n\nexports.jazz.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.jazz || (requires.jazz = require('jazz'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      tmpl.eval(options, function (str) {\n        cb(null, str);\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * JQTPL support.\n */\n\n\nexports.jqtpl = fromStringRenderer('jqtpl');\n/**\n * JQTPL string support.\n */\n\nexports.jqtpl.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.jqtpl || (requires.jqtpl = require('jqtpl'));\n\n    try {\n      engine.template(str, str);\n      cb(null, engine.tmpl(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Haml support.\n */\n\n\nexports.haml = fromStringRenderer('haml');\n/**\n * Haml string support.\n */\n\nexports.haml.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.haml || (requires.haml = require('hamljs'));\n\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Hamlet support.\n */\n\n\nexports.hamlet = fromStringRenderer('hamlet');\n/**\n * Hamlet string support.\n */\n\nexports.hamlet.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.hamlet || (requires.hamlet = require('hamlet'));\n\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Whiskers support.\n */\n\n\nexports.whiskers = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.whiskers || (requires.whiskers = require('whiskers'));\n\n    engine.__express(path, options, cb);\n  });\n};\n/**\n * Whiskers string support.\n */\n\n\nexports.whiskers.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.whiskers || (requires.whiskers = require('whiskers'));\n\n    try {\n      cb(null, engine.render(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Coffee-HAML support.\n */\n\n\nexports['haml-coffee'] = fromStringRenderer('haml-coffee');\n/**\n * Coffee-HAML string support.\n */\n\nexports['haml-coffee'].render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires['haml-coffee'] || (requires['haml-coffee'] = require('haml-coffee'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Hogan support.\n */\n\n\nexports.hogan = fromStringRenderer('hogan');\n/**\n * Hogan string support.\n */\n\nexports.hogan.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.hogan || (requires.hogan = require('hogan.js'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl.render(options, options.partials));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * templayed.js support.\n */\n\n\nexports.templayed = fromStringRenderer('templayed');\n/**\n * templayed.js string support.\n */\n\nexports.templayed.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.templayed || (requires.templayed = require('templayed'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine(str));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Handlebars support.\n */\n\n\nexports.handlebars = fromStringRenderer('handlebars');\n/**\n * Handlebars string support.\n */\n\nexports.handlebars.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.handlebars || (requires.handlebars = require('handlebars'));\n\n    try {\n      for (var partial in options.partials) {\n        engine.registerPartial(partial, options.partials[partial]);\n      }\n\n      for (var helper in options.helpers) {\n        engine.registerHelper(helper, options.helpers[helper]);\n      }\n\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Underscore support.\n */\n\n\nexports.underscore = fromStringRenderer('underscore');\n/**\n * Underscore string support.\n */\n\nexports.underscore.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.underscore || (requires.underscore = require('underscore'));\n\n    try {\n      const partials = {};\n\n      for (var partial in options.partials) {\n        partials[partial] = engine.template(options.partials[partial]);\n      }\n\n      options.partials = partials;\n      var tmpl = cache(options) || cache(options, engine.template(str, null, options));\n      cb(null, tmpl(options).replace(/\\n$/, ''));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Lodash support.\n */\n\n\nexports.lodash = fromStringRenderer('lodash');\n/**\n * Lodash string support.\n */\n\nexports.lodash.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.lodash || (requires.lodash = require('lodash'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.template(str, options));\n      cb(null, tmpl(options).replace(/\\n$/, ''));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Pug support. (formerly Jade)\n */\n\n\nexports.pug = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.pug;\n\n    if (!engine) {\n      try {\n        engine = requires.pug = require('pug');\n      } catch (err) {\n        try {\n          engine = requires.pug = require('then-pug');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compileFile(path, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Pug string support.\n */\n\n\nexports.pug.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.pug;\n\n    if (!engine) {\n      try {\n        engine = requires.pug = require('pug');\n      } catch (err) {\n        try {\n          engine = requires.pug = require('then-pug');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * QEJS support.\n */\n\n\nexports.qejs = fromStringRenderer('qejs');\n/**\n * QEJS string support.\n */\n\nexports.qejs.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    try {\n      var engine = requires.qejs || (requires.qejs = require('qejs'));\n\n      engine.render(str, options).then(function (result) {\n        cb(null, result);\n      }, function (err) {\n        cb(err);\n      }).done();\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Walrus support.\n */\n\n\nexports.walrus = fromStringRenderer('walrus');\n/**\n * Walrus string support.\n */\n\nexports.walrus.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.walrus || (requires.walrus = require('walrus'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.parse(str));\n      cb(null, tmpl.compile(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Mustache support.\n */\n\n\nexports.mustache = fromStringRenderer('mustache');\n/**\n * Mustache string support.\n */\n\nexports.mustache.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.mustache || (requires.mustache = require('mustache'));\n\n    try {\n      cb(null, engine.render(str, options, options.partials));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Just support.\n */\n\n\nexports.just = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.just;\n\n    if (!engine) {\n      var JUST = require('just');\n\n      engine = requires.just = new JUST();\n    }\n\n    engine.configure({\n      useCache: options.cache\n    });\n    engine.render(path, options, cb);\n  });\n};\n/**\n * Just string support.\n */\n\n\nexports.just.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var JUST = require('just');\n\n    var engine = new JUST({\n      root: {\n        page: str\n      }\n    });\n    engine.render('page', options, cb);\n  });\n};\n/**\n * ECT support.\n */\n\n\nexports.ect = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.ect;\n\n    if (!engine) {\n      var ECT = require('ect');\n\n      engine = requires.ect = new ECT(options);\n    }\n\n    engine.configure({\n      cache: options.cache\n    });\n    engine.render(path, options, cb);\n  });\n};\n/**\n * ECT string support.\n */\n\n\nexports.ect.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var ECT = require('ect');\n\n    var engine = new ECT({\n      root: {\n        page: str\n      }\n    });\n    engine.render('page', options, cb);\n  });\n};\n/**\n * mote support.\n */\n\n\nexports.mote = fromStringRenderer('mote');\n/**\n * mote string support.\n */\n\nexports.mote.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.mote || (requires.mote = require('mote'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Toffee support.\n */\n\n\nexports.toffee = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var toffee = requires.toffee || (requires.toffee = require('toffee'));\n\n    toffee.__consolidate_engine_render(path, options, cb);\n  });\n};\n/**\n * Toffee string support.\n */\n\n\nexports.toffee.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.toffee || (requires.toffee = require('toffee'));\n\n    try {\n      engine.str_render(str, options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * doT support.\n */\n\n\nexports.dot = fromStringRenderer('dot');\n/**\n * doT string support.\n */\n\nexports.dot.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.dot || (requires.dot = require('dot'));\n\n    var extend = requires.extend || (requires.extend = require('util')._extend);\n\n    try {\n      var settings = {};\n      settings = extend(settings, engine.templateSettings);\n      settings = extend(settings, options ? options.dot : {});\n      var tmpl = cache(options) || cache(options, engine.template(str, settings, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * bracket support.\n */\n\n\nexports.bracket = fromStringRenderer('bracket');\n/**\n * bracket string support.\n */\n\nexports.bracket.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.bracket || (requires.bracket = require('bracket-template'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.default.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Ractive support.\n */\n\n\nexports.ractive = fromStringRenderer('ractive');\n/**\n * Ractive string support.\n */\n\nexports.ractive.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var Engine = requires.ractive || (requires.ractive = require('ractive'));\n\n    var template = cache(options) || cache(options, Engine.parse(str));\n    options.template = template;\n\n    if (options.data === null || options.data === undefined) {\n      var extend = requires.extend || (requires.extend = require('util')._extend); // Shallow clone the options object\n\n\n      options.data = extend({}, options); // Remove consolidate-specific properties from the clone\n\n      var i;\n      var length;\n      var properties = ['template', 'filename', 'cache', 'partials'];\n\n      for (i = 0, length = properties.length; i < length; i++) {\n        var property = properties[i];\n        delete options.data[property];\n      }\n    }\n\n    try {\n      cb(null, new Engine(options).toHTML());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Nunjucks support.\n */\n\n\nexports.nunjucks = fromStringRenderer('nunjucks');\n/**\n * Nunjucks string support.\n */\n\nexports.nunjucks.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    try {\n      var engine = options.nunjucksEnv || requires.nunjucks || (requires.nunjucks = require('nunjucks'));\n\n      var env = engine; // deprecated fallback support for express\n      // <https://github.com/tj/consolidate.js/pull/152>\n      // <https://github.com/tj/consolidate.js/pull/224>\n\n      if (options.settings && options.settings.views) {\n        env = engine.configure(options.settings.views);\n      } else if (options.nunjucks && options.nunjucks.configure) {\n        env = engine.configure.apply(engine, options.nunjucks.configure);\n      } //\n      // because `renderString` does not initiate loaders\n      // we must manually create a loader for it based off\n      // either `options.settings.views` or `options.nunjucks` or `options.nunjucks.root`\n      //\n      // <https://github.com/mozilla/nunjucks/issues/730>\n      // <https://github.com/crocodilejs/node-email-templates/issues/182>\n      //\n      // so instead we simply check if we passed a custom loader\n      // otherwise we create a simple file based loader\n\n\n      if (options.loader) {\n        env = new engine.Environment(options.loader);\n      } else if (options.settings && options.settings.views) {\n        env = new engine.Environment(new engine.FileSystemLoader(options.settings.views));\n      } else if (options.nunjucks && options.nunjucks.loader) {\n        if (typeof options.nunjucks.loader === 'string') {\n          env = new engine.Environment(new engine.FileSystemLoader(options.nunjucks.loader));\n        } else {\n          env = new engine.Environment(new engine.FileSystemLoader(options.nunjucks.loader[0], options.nunjucks.loader[1]));\n        }\n      }\n\n      env.renderString(str, options, cb);\n    } catch (err) {\n      throw cb(err);\n    }\n  });\n};\n/**\n * HTMLing support.\n */\n\n\nexports.htmling = fromStringRenderer('htmling');\n/**\n * HTMLing string support.\n */\n\nexports.htmling.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.htmling || (requires.htmling = require('htmling'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.string(str));\n      cb(null, tmpl.render(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n *  Rendering function\n */\n\n\nfunction requireReact(module, filename) {\n  var babel = requires.babel || (requires.babel = require('babel-core'));\n\n  var compiled = babel.transformFileSync(filename, {\n    presets: ['react']\n  }).code;\n  return module._compile(compiled, filename);\n}\n\nexports.requireReact = requireReact;\n/**\n *  Converting a string into a node module.\n */\n\nfunction requireReactString(src, filename) {\n  var babel = requires.babel || (requires.babel = require('babel-core'));\n\n  if (!filename) filename = '';\n  var m = new module.constructor();\n  filename = filename || ''; // Compile Using React\n\n  var compiled = babel.transform(src, {\n    presets: ['react']\n  }).code; // Compile as a module\n\n  m.paths = module.paths;\n\n  m._compile(compiled, filename);\n\n  return m.exports;\n}\n/**\n * A naive helper to replace {{tags}} with options.tags content\n */\n\n\nfunction reactBaseTmpl(data, options) {\n  var exp;\n  var regex; // Iterates through the keys in file object\n  // and interpolate / replace {{key}} with it's value\n\n  for (var k in options) {\n    if (options.hasOwnProperty(k)) {\n      exp = '{{' + k + '}}';\n      regex = new RegExp(exp, 'g');\n\n      if (data.match(regex)) {\n        data = data.replace(regex, options[k]);\n      }\n    }\n  }\n\n  return data;\n}\n/**\n* Plates Support.\n*/\n\n\nexports.plates = fromStringRenderer('plates');\n/**\n* Plates string support.\n*/\n\nexports.plates.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.plates || (requires.plates = require('plates'));\n\n    var map = options.map || undefined;\n\n    try {\n      var tmpl = engine.bind(str, options, map);\n      cb(null, tmpl);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n *  The main render parser for React bsaed templates\n */\n\n\nfunction reactRenderer(type) {\n  if (require.extensions) {\n    // Ensure JSX is transformed on require\n    if (!require.extensions['.jsx']) {\n      require.extensions['.jsx'] = requireReact;\n    } // Supporting .react extension as well as test cases\n    // Using .react extension is not recommended.\n\n\n    if (!require.extensions['.react']) {\n      require.extensions['.react'] = requireReact;\n    }\n  } // Return rendering fx\n\n\n  return function (str, options, cb) {\n    return promisify(cb, function (cb) {\n      // React Import\n      var ReactDOM = requires.ReactDOM || (requires.ReactDOM = require('react-dom/server'));\n\n      var react = requires.react || (requires.react = require('react')); // Assign HTML Base\n\n\n      var base = options.base;\n      delete options.base;\n      var enableCache = options.cache;\n      delete options.cache;\n      var isNonStatic = options.isNonStatic;\n      delete options.isNonStatic; // Start Conversion\n\n      try {\n        var Code;\n        var Factory;\n        var baseStr;\n        var content;\n        var parsed;\n\n        if (!cache(options)) {\n          // Parsing\n          if (type === 'path') {\n            var path = resolve(str);\n            delete require.cache[path];\n            Code = require(path);\n          } else {\n            Code = requireReactString(str);\n          }\n\n          Factory = cache(options, react.createFactory(Code));\n        } else {\n          Factory = cache(options);\n        }\n\n        parsed = new Factory(options);\n        content = isNonStatic ? ReactDOM.renderToString(parsed) : ReactDOM.renderToStaticMarkup(parsed);\n\n        if (base) {\n          baseStr = readCache[str] || fs.readFileSync(resolve(base), 'utf8');\n\n          if (enableCache) {\n            readCache[str] = baseStr;\n          }\n\n          options.content = content;\n          content = reactBaseTmpl(baseStr, options);\n        }\n\n        cb(null, content);\n      } catch (err) {\n        cb(err);\n      }\n    });\n  };\n}\n/**\n * React JS Support\n */\n\n\nexports.react = reactRenderer('path');\n/**\n * React JS string support.\n */\n\nexports.react.render = reactRenderer('string');\n/**\n * ARC-templates support.\n */\n\nexports['arc-templates'] = fromStringRenderer('arc-templates');\n/**\n * ARC-templates string support.\n */\n\nexports['arc-templates'].render = function (str, options, cb) {\n  var readFileWithOptions = Promise.promisify(read);\n  var consolidateFileSystem = {};\n\n  consolidateFileSystem.readFile = function (path) {\n    return readFileWithOptions(path, options);\n  };\n\n  return promisify(cb, function (cb) {\n    try {\n      var engine = requires['arc-templates'];\n\n      if (!engine) {\n        var Engine = require('arc-templates/dist/es5');\n\n        engine = requires['arc-templates'] = new Engine({\n          filesystem: consolidateFileSystem\n        });\n      }\n\n      var compiler = cache(options) || cache(options, engine.compileString(str, options.filename));\n      compiler.then(function (func) {\n        return func(options);\n      }).then(function (result) {\n        cb(null, result.content);\n      }).catch(cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Vash support\n */\n\n\nexports.vash = fromStringRenderer('vash');\n/**\n * Vash string support\n */\n\nexports.vash.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.vash || (requires.vash = require('vash'));\n\n    try {\n      // helper system : https://github.com/kirbysayshi/vash#helper-system\n      if (options.helpers) {\n        for (var key in options.helpers) {\n          if (!options.helpers.hasOwnProperty(key) || typeof options.helpers[key] !== 'function') {\n            continue;\n          }\n\n          engine.helpers[key] = options.helpers[key];\n        }\n      }\n\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      tmpl(options, function sealLayout(err, ctx) {\n        if (err) cb(err);\n        ctx.finishLayout();\n        cb(null, ctx.toString().replace(/\\n$/, ''));\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Slm support.\n */\n\n\nexports.slm = fromStringRenderer('slm');\n/**\n * Slm string support.\n */\n\nexports.slm.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.slm || (requires.slm = require('slm'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Marko support.\n */\n\n\nexports.marko = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.marko || (requires.marko = require('marko'));\n\n    options.writeToDisk = !!options.cache;\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.load(path, options));\n      tmpl.renderToString(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Marko string support.\n */\n\n\nexports.marko.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.marko || (requires.marko = require('marko'));\n\n    options.writeToDisk = !!options.cache;\n    options.filename = options.filename || 'string.marko';\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.load(options.filename, str, options));\n      tmpl.renderToString(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Teacup support.\n */\n\n\nexports.teacup = function (path, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.teacup || (requires.teacup = require('teacup/lib/express'));\n\n    require.extensions['.teacup'] = require.extensions['.coffee'];\n\n    if (path[0] !== '/') {\n      path = join(process.cwd(), path);\n    }\n\n    if (!options.cache) {\n      var callback = cb;\n\n      cb = function () {\n        delete require.cache[path];\n        callback.apply(this, arguments);\n      };\n    }\n\n    engine.renderFile(path, options, cb);\n  });\n};\n/**\n * Teacup string support.\n */\n\n\nexports.teacup.render = function (str, options, cb) {\n  var coffee = require('coffee-script');\n\n  var vm = require('vm');\n\n  var sandbox = {\n    module: {\n      exports: {}\n    },\n    require: require\n  };\n  return promisify(cb, function (cb) {\n    vm.runInNewContext(coffee.compile(str), sandbox);\n    var tmpl = sandbox.module.exports;\n    cb(null, tmpl(options));\n  });\n};\n/**\n * Squirrelly support.\n */\n\n\nexports.squirrelly = fromStringRenderer('squirrelly');\n/**\n * Squirrelly string support.\n */\n\nexports.squirrelly.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.squirrelly || (requires.squirrelly = require('squirrelly'));\n\n    try {\n      for (var partial in options.partials) {\n        engine.definePartial(partial, options.partials[partial]);\n      }\n\n      for (var helper in options.helpers) {\n        engine.defineHelper(helper, options.helpers[helper]);\n      }\n\n      var tmpl = cache(options) || cache(options, engine.Compile(str, options));\n      cb(null, tmpl(options, engine));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Twing support.\n */\n\n\nexports.twing = fromStringRenderer('twing');\n/**\n * Twing string support.\n */\n\nexports.twing.render = function (str, options, cb) {\n  return promisify(cb, function (cb) {\n    var engine = requires.twing || (requires.twing = require('twing'));\n\n    try {\n      new engine.TwingEnvironment(new engine.TwingLoaderNull()).createTemplate(str).then(twingTemplate => {\n        twingTemplate.render(options).then(rendTmpl => {\n          var tmpl = cache(options) || cache(options, rendTmpl);\n          cb(null, tmpl);\n        });\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * expose the instance of the engine\n */\n\n\nexports.requires = requires;","map":{"version":3,"sources":["/home/phuocnghia712/Desktop/Cshttt/node_modules/consolidate/lib/consolidate.js"],"names":["fs","require","path","Promise","join","resolve","extname","dirname","isAbsolute","readCache","cacheStore","requires","exports","clearCache","cache","options","compiled","filename","read","cb","str","cached","readFile","err","replace","readPartials","partials","keys","Object","next","index","length","key","partialPath","undefined","file","promisify","fn","reject","html","fromStringRenderer","name","extend","_extend","opts","render","velocityjs","engine","locals","trimLeft","liquid","_renderTinyliquid","context","newContext","k","setLocals","meta","filters","setFilter","includeDir","process","cwd","onInclude","callback","encoding","data","parse","compileOptions","customTags","tagFunctions","body","tpl","trim","astStack","push","tmpl","compile","Liquid","Engine","pages","registerFilters","fileSystem","LocalFileSystem","registerTag","parseAndRender","nodeify","result","Error","jade","otherError","compileFile","dust","ext","views","settings","onLoad","templateName","RegExp","compileFn","swig","setDefaults","razor","console","log","renderFileSync","tf","atpl","liquor","twig","templateData","allowInlineIncludes","namespaces","ejs","eco","jazz","eval","jqtpl","template","haml","hamlet","whiskers","__express","hogan","templayed","handlebars","partial","registerPartial","helper","helpers","registerHelper","underscore","lodash","pug","qejs","then","done","walrus","mustache","just","JUST","configure","useCache","root","page","ect","ECT","mote","toffee","__consolidate_engine_render","str_render","dot","templateSettings","bracket","default","ractive","i","properties","property","toHTML","nunjucks","nunjucksEnv","env","apply","loader","Environment","FileSystemLoader","renderString","htmling","string","requireReact","module","babel","transformFileSync","presets","code","_compile","requireReactString","src","m","constructor","transform","paths","reactBaseTmpl","exp","regex","hasOwnProperty","match","plates","map","bind","reactRenderer","type","extensions","ReactDOM","react","base","enableCache","isNonStatic","Code","Factory","baseStr","content","parsed","createFactory","renderToString","renderToStaticMarkup","readFileSync","readFileWithOptions","consolidateFileSystem","filesystem","compiler","compileString","func","catch","vash","sealLayout","ctx","finishLayout","toString","slm","marko","writeToDisk","load","teacup","arguments","renderFile","coffee","vm","sandbox","runInNewContext","squirrelly","definePartial","defineHelper","Compile","twing","TwingEnvironment","TwingLoaderNull","createTemplate","twingTemplate","rendTmpl"],"mappings":"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","sourcesContent":["'use strict';\n/*\n * Engines which do not support caching of their file contents\n * should use the `read()` function defined in consolidate.js\n * On top of this, when an engine compiles to a `Function`,\n * these functions should either be cached within consolidate.js\n * or the engine itself via `options.cache`. This will allow\n * users and frameworks to pass `options.cache = true` for\n * `NODE_ENV=production`, however edit the file(s) without\n * re-loading the application in development.\n */\n\n/**\n * Module dependencies.\n */\n\nvar fs = require('fs');\nvar path = require('path');\nvar Promise = require('bluebird');\n\nvar join = path.join;\nvar resolve = path.resolve;\nvar extname = path.extname;\nvar dirname = path.dirname;\nvar isAbsolute = path.isAbsolute;\n\nvar readCache = {};\n\n/**\n * Require cache.\n */\n\nvar cacheStore = {};\n\n/**\n * Require cache.\n */\n\nvar requires = {};\n\n/**\n * Clear the cache.\n *\n * @api public\n */\n\nexports.clearCache = function() {\n  readCache = {};\n  cacheStore = {};\n};\n\n/**\n * Conditionally cache `compiled` template based\n * on the `options` filename and `.cache` boolean.\n *\n * @param {Object} options\n * @param {Function} compiled\n * @return {Function}\n * @api private\n */\n\nfunction cache(options, compiled) {\n  // cachable\n  if (compiled && options.filename && options.cache) {\n    delete readCache[options.filename];\n    cacheStore[options.filename] = compiled;\n    return compiled;\n  }\n\n  // check cache\n  if (options.filename && options.cache) {\n    return cacheStore[options.filename];\n  }\n\n  return compiled;\n}\n\n/**\n * Read `path` with `options` with\n * callback `(err, str)`. When `options.cache`\n * is true the template string will be cached.\n *\n * @param {String} options\n * @param {Function} cb\n * @api private\n */\n\nfunction read(path, options, cb) {\n  var str = readCache[path];\n  var cached = options.cache && str && typeof str === 'string';\n\n  // cached (only if cached is a string and not a compiled template function)\n  if (cached) return cb(null, str);\n\n  // read\n  fs.readFile(path, 'utf8', function(err, str) {\n    if (err) return cb(err);\n    // remove extraneous utf8 BOM marker\n    str = str.replace(/^\\uFEFF/, '');\n    if (options.cache) readCache[path] = str;\n    cb(null, str);\n  });\n}\n\n/**\n * Read `path` with `options` with\n * callback `(err, str)`. When `options.cache`\n * is true the partial string will be cached.\n *\n * @param {String} options\n * @param {Function} fn\n * @api private\n */\n\nfunction readPartials(path, options, cb) {\n  if (!options.partials) return cb();\n  var keys = Object.keys(options.partials);\n  var partials = {};\n\n  function next(index) {\n    if (index === keys.length) return cb(null, partials);\n    var key = keys[index];\n    var partialPath = options.partials[key];\n\n    if (partialPath === undefined || partialPath === null || partialPath === false) {\n      return next(++index);\n    }\n\n    var file;\n    if (isAbsolute(partialPath)) {\n      if (extname(partialPath) !== '') {\n        file = partialPath;\n      } else {\n        file = join(partialPath + extname(path));\n      }\n    } else {\n      file = join(dirname(path), partialPath + extname(path));\n    }\n\n    read(file, options, function(err, str) {\n      if (err) return cb(err);\n      partials[key] = str;\n      next(++index);\n    });\n  }\n\n  next(0);\n}\n\n/**\n * promisify\n */\nfunction promisify(cb, fn) {\n  return new Promise(function(resolve, reject) {\n    cb = cb || function(err, html) {\n      if (err) {\n        return reject(err);\n      }\n      resolve(html);\n    };\n    fn(cb);\n  });\n}\n\n/**\n * fromStringRenderer\n */\n\nfunction fromStringRenderer(name) {\n  return function(path, options, cb) {\n    options.filename = path;\n\n    return promisify(cb, function(cb) {\n      readPartials(path, options, function(err, partials) {\n        var extend = (requires.extend || (requires.extend = require('util')._extend));\n        var opts = extend({}, options);\n        opts.partials = partials;\n        if (err) return cb(err);\n        if (cache(opts)) {\n          exports[name].render('', opts, cb);\n        } else {\n          read(path, opts, function(err, str) {\n            if (err) return cb(err);\n            exports[name].render(str, opts, cb);\n          });\n        }\n      });\n    });\n  };\n}\n\n/**\n * velocity support.\n */\n\nexports.velocityjs = fromStringRenderer('velocityjs');\n\n/**\n * velocity string support.\n */\n\nexports.velocityjs.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.velocityjs || (requires.velocityjs = require('velocityjs'));\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Liquid support.\n */\n\nexports.liquid = fromStringRenderer('liquid');\n\n/**\n * Liquid string support.\n */\n\n/**\n * Note that in order to get filters and custom tags we've had to push\n * all user-defined locals down into @locals. However, just to make things\n * backwards-compatible, any property of `options` that is left after\n * processing and removing `locals`, `meta`, `filters`, `customTags` and\n * `includeDir` will also become a local.\n */\n\nfunction _renderTinyliquid(engine, str, options, cb) {\n  var context = engine.newContext();\n  var k;\n\n  /**\n   * Note that there's a bug in the library that doesn't allow us to pass\n   * the locals to newContext(), hence looping through the keys:\n   */\n\n  if (options.locals) {\n    for (k in options.locals) {\n      context.setLocals(k, options.locals[k]);\n    }\n    delete options.locals;\n  }\n\n  if (options.meta) {\n    context.setLocals('page', options.meta);\n    delete options.meta;\n  }\n\n  /**\n   * Add any defined filters:\n   */\n\n  if (options.filters) {\n    for (k in options.filters) {\n      context.setFilter(k, options.filters[k]);\n    }\n    delete options.filters;\n  }\n\n  /**\n   * Set up a callback for the include directory:\n   */\n\n  var includeDir = options.includeDir || process.cwd();\n\n  context.onInclude(function(name, callback) {\n    var extname = path.extname(name) ? '' : '.liquid';\n    var filename = path.resolve(includeDir, name + extname);\n\n    fs.readFile(filename, {encoding: 'utf8'}, function(err, data) {\n      if (err) return callback(err);\n      callback(null, engine.parse(data));\n    });\n  });\n  delete options.includeDir;\n\n  /**\n   * The custom tag functions need to have their results pushed back\n   * through the parser, so set up a shim before calling the provided\n   * callback:\n   */\n\n  var compileOptions = {\n    customTags: {}\n  };\n\n  if (options.customTags) {\n    var tagFunctions = options.customTags;\n\n    for (k in options.customTags) {\n      /*Tell jshint there's no problem with having this function in the loop */\n      /*jshint -W083 */\n      compileOptions.customTags[k] = function(context, name, body) {\n        var tpl = tagFunctions[name](body.trim());\n        context.astStack.push(engine.parse(tpl));\n      };\n      /*jshint +W083 */\n    }\n    delete options.customTags;\n  }\n\n  /**\n   * Now anything left in `options` becomes a local:\n   */\n\n  for (k in options) {\n    context.setLocals(k, options[k]);\n  }\n\n  /**\n   * Finally, execute the template:\n   */\n\n  var tmpl = cache(context) || cache(context, engine.compile(str, compileOptions));\n  tmpl(context, cb);\n}\n\nexports.liquid.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.liquid;\n    var Liquid;\n\n    try {\n      // set up tinyliquid engine\n      engine = requires.liquid = require('tinyliquid');\n\n      // use tinyliquid engine\n      _renderTinyliquid(engine, str, options, cb);\n\n      return;\n\n    } catch (err) {\n\n      // set up liquid-node engine\n      try {\n        Liquid = requires.liquid = require('liquid-node');\n        engine = new Liquid.Engine();\n      } catch (err) {\n        throw err;\n      }\n\n    }\n\n    // use liquid-node engine\n    try {\n      var locals = options.locals || {};\n\n      if (options.meta) {\n        locals.pages = options.meta;\n        delete options.meta;\n      }\n\n      /**\n       * Add any defined filters:\n       */\n\n      if (options.filters) {\n        engine.registerFilters(options.filters);\n        delete options.filters;\n      }\n\n      /**\n       * Set up a callback for the include directory:\n       */\n\n      var includeDir = options.includeDir || process.cwd();\n      engine.fileSystem = new Liquid.LocalFileSystem(includeDir, 'liquid');\n      delete options.includeDir;\n\n      /**\n       * The custom tag functions need to have their results pushed back\n       * through the parser, so set up a shim before calling the provided\n       * callback:\n       */\n\n      if (options.customTags) {\n        var tagFunctions = options.customTags;\n\n        for (k in options.customTags) {\n          engine.registerTag(k, tagFunctions[k]);\n        }\n        delete options.customTags;\n      }\n\n      /**\n       * Now anything left in `options` becomes a local:\n       */\n\n      for (var k in options) {\n        locals[k] = options[k];\n      }\n\n      /**\n       * Finally, execute the template:\n       */\n\n      return engine\n        .parseAndRender(str, locals)\n        .nodeify(function(err, result) {\n          if (err) {\n            throw new Error(err);\n          } else {\n            return cb(null, result);\n          }\n        });\n\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Jade support.\n */\n\nexports.jade = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.jade;\n    if (!engine) {\n      try {\n        engine = requires.jade = require('jade');\n      } catch (err) {\n        try {\n          engine = requires.jade = require('then-jade');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compileFile(path, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Jade string support.\n */\n\nexports.jade.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.jade;\n    if (!engine) {\n      try {\n        engine = requires.jade = require('jade');\n      } catch (err) {\n        try {\n          engine = requires.jade = require('then-jade');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Dust support.\n */\n\nexports.dust = fromStringRenderer('dust');\n\n/**\n * Dust string support.\n */\n\nexports.dust.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.dust;\n    if (!engine) {\n      try {\n        engine = requires.dust = require('dust');\n      } catch (err) {\n        try {\n          engine = requires.dust = require('dustjs-helpers');\n        } catch (err) {\n          engine = requires.dust = require('dustjs-linkedin');\n        }\n      }\n    }\n\n    var ext = 'dust';\n    var views = '.';\n\n    if (options) {\n      if (options.ext) ext = options.ext;\n      if (options.views) views = options.views;\n      if (options.settings && options.settings.views) views = options.settings.views;\n    }\n    if (!options || (options && !options.cache)) engine.cache = {};\n\n    engine.onLoad = function(path, callback) {\n      if (extname(path) === '') path += '.' + ext;\n      if (path[0] !== '/') path = views + '/' + path;\n      read(path, options, callback);\n    };\n\n    try {\n      var templateName;\n      if (options.filename) {\n        templateName = options.filename.replace(new RegExp('^' + views + '/'), '').replace(new RegExp('\\\\.' + ext), '');\n      }\n\n      var tmpl = cache(options) || cache(options, engine.compileFn(str, templateName));\n      tmpl(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Swig support.\n */\n\nexports.swig = fromStringRenderer('swig');\n\n/**\n * Swig string support.\n */\n\nexports.swig.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.swig;\n    if (!engine) {\n      try {\n        engine = requires.swig = require('swig');\n      } catch (err) {\n        try {\n          engine = requires.swig = require('swig-templates');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      if (options.cache === true) options.cache = 'memory';\n      engine.setDefaults({ cache: options.cache });\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Razor support.\n */\n\nexports.razor = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.razor;\n    if (!engine) {\n      try {\n        engine = requires.razor = require('razor-tmpl');\n\n      } catch (err) {\n\n        throw err;\n\n      }\n    }\n    try {\n\n      var tmpl = cache(options) || cache(options, (locals) => {\n        console.log('Rendering razor file', path);\n        return engine.renderFileSync(path, locals);\n      });\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * razor string support.\n */\n\nexports.razor.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n\n    try {\n      var engine = requires.razor = require('razor-tmpl');\n    } catch (err) {\n      throw err;\n    }\n\n    try {\n      var tf = engine.compile(str);\n      var tmpl = cache(options) || cache(options, tf);\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Atpl support.\n */\n\nexports.atpl = fromStringRenderer('atpl');\n\n/**\n * Atpl string support.\n */\n\nexports.atpl.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.atpl || (requires.atpl = require('atpl'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Liquor support,\n */\n\nexports.liquor = fromStringRenderer('liquor');\n\n/**\n * Liquor string support.\n */\n\nexports.liquor.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.liquor || (requires.liquor = require('liquor'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Twig support.\n */\n\nexports.twig = fromStringRenderer('twig');\n\n/**\n * Twig string support.\n */\n\nexports.twig.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.twig || (requires.twig = require('twig').twig);\n    var templateData = {\n      data: str,\n      allowInlineIncludes: options.allowInlineIncludes,\n      namespaces: options.namespaces,\n      path: options.path\n    };\n    try {\n      var tmpl = cache(templateData) || cache(templateData, engine(templateData));\n      cb(null, tmpl.render(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * EJS support.\n */\n\nexports.ejs = fromStringRenderer('ejs');\n\n/**\n * EJS string support.\n */\n\nexports.ejs.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.ejs || (requires.ejs = require('ejs'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Eco support.\n */\n\nexports.eco = fromStringRenderer('eco');\n\n/**\n * Eco string support.\n */\n\nexports.eco.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.eco || (requires.eco = require('eco'));\n    try {\n      cb(null, engine.render(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Jazz support.\n */\n\nexports.jazz = fromStringRenderer('jazz');\n\n/**\n * Jazz string support.\n */\n\nexports.jazz.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.jazz || (requires.jazz = require('jazz'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      tmpl.eval(options, function(str) {\n        cb(null, str);\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * JQTPL support.\n */\n\nexports.jqtpl = fromStringRenderer('jqtpl');\n\n/**\n * JQTPL string support.\n */\n\nexports.jqtpl.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.jqtpl || (requires.jqtpl = require('jqtpl'));\n    try {\n      engine.template(str, str);\n      cb(null, engine.tmpl(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Haml support.\n */\n\nexports.haml = fromStringRenderer('haml');\n\n/**\n * Haml string support.\n */\n\nexports.haml.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.haml || (requires.haml = require('hamljs'));\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Hamlet support.\n */\n\nexports.hamlet = fromStringRenderer('hamlet');\n\n/**\n * Hamlet string support.\n */\n\nexports.hamlet.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.hamlet || (requires.hamlet = require('hamlet'));\n    try {\n      options.locals = options;\n      cb(null, engine.render(str, options).trimLeft());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Whiskers support.\n */\n\nexports.whiskers = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.whiskers || (requires.whiskers = require('whiskers'));\n    engine.__express(path, options, cb);\n  });\n};\n\n/**\n * Whiskers string support.\n */\n\nexports.whiskers.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.whiskers || (requires.whiskers = require('whiskers'));\n    try {\n      cb(null, engine.render(str, options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Coffee-HAML support.\n */\n\nexports['haml-coffee'] = fromStringRenderer('haml-coffee');\n\n/**\n * Coffee-HAML string support.\n */\n\nexports['haml-coffee'].render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires['haml-coffee'] || (requires['haml-coffee'] = require('haml-coffee'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Hogan support.\n */\n\nexports.hogan = fromStringRenderer('hogan');\n\n/**\n * Hogan string support.\n */\n\nexports.hogan.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.hogan || (requires.hogan = require('hogan.js'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl.render(options, options.partials));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * templayed.js support.\n */\n\nexports.templayed = fromStringRenderer('templayed');\n\n/**\n * templayed.js string support.\n */\n\nexports.templayed.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.templayed || (requires.templayed = require('templayed'));\n    try {\n      var tmpl = cache(options) || cache(options, engine(str));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Handlebars support.\n */\n\nexports.handlebars = fromStringRenderer('handlebars');\n\n/**\n * Handlebars string support.\n */\n\nexports.handlebars.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.handlebars || (requires.handlebars = require('handlebars'));\n    try {\n      for (var partial in options.partials) {\n        engine.registerPartial(partial, options.partials[partial]);\n      }\n      for (var helper in options.helpers) {\n        engine.registerHelper(helper, options.helpers[helper]);\n      }\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Underscore support.\n */\n\nexports.underscore = fromStringRenderer('underscore');\n\n/**\n * Underscore string support.\n */\n\nexports.underscore.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.underscore || (requires.underscore = require('underscore'));\n    try {\n      const partials = {};\n      for (var partial in options.partials) {\n        partials[partial] = engine.template(options.partials[partial]);\n      }\n      options.partials = partials;\n      var tmpl = cache(options) || cache(options, engine.template(str, null, options));\n      cb(null, tmpl(options).replace(/\\n$/, ''));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Lodash support.\n */\n\nexports.lodash = fromStringRenderer('lodash');\n\n/**\n * Lodash string support.\n */\n\nexports.lodash.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.lodash || (requires.lodash = require('lodash'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.template(str, options));\n      cb(null, tmpl(options).replace(/\\n$/, ''));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Pug support. (formerly Jade)\n */\n\nexports.pug = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.pug;\n    if (!engine) {\n      try {\n        engine = requires.pug = require('pug');\n      } catch (err) {\n        try {\n          engine = requires.pug = require('then-pug');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compileFile(path, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Pug string support.\n */\n\nexports.pug.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.pug;\n    if (!engine) {\n      try {\n        engine = requires.pug = require('pug');\n      } catch (err) {\n        try {\n          engine = requires.pug = require('then-pug');\n        } catch (otherError) {\n          throw err;\n        }\n      }\n    }\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * QEJS support.\n */\n\nexports.qejs = fromStringRenderer('qejs');\n\n/**\n * QEJS string support.\n */\n\nexports.qejs.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    try {\n      var engine = requires.qejs || (requires.qejs = require('qejs'));\n      engine.render(str, options).then(function(result) {\n        cb(null, result);\n      }, function(err) {\n        cb(err);\n      }).done();\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Walrus support.\n */\n\nexports.walrus = fromStringRenderer('walrus');\n\n/**\n * Walrus string support.\n */\n\nexports.walrus.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.walrus || (requires.walrus = require('walrus'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.parse(str));\n      cb(null, tmpl.compile(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Mustache support.\n */\n\nexports.mustache = fromStringRenderer('mustache');\n\n/**\n * Mustache string support.\n */\n\nexports.mustache.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.mustache || (requires.mustache = require('mustache'));\n    try {\n      cb(null, engine.render(str, options, options.partials));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Just support.\n */\n\nexports.just = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.just;\n    if (!engine) {\n      var JUST = require('just');\n      engine = requires.just = new JUST();\n    }\n    engine.configure({ useCache: options.cache });\n    engine.render(path, options, cb);\n  });\n};\n\n/**\n * Just string support.\n */\n\nexports.just.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var JUST = require('just');\n    var engine = new JUST({ root: { page: str }});\n    engine.render('page', options, cb);\n  });\n};\n\n/**\n * ECT support.\n */\n\nexports.ect = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.ect;\n    if (!engine) {\n      var ECT = require('ect');\n      engine = requires.ect = new ECT(options);\n    }\n    engine.configure({ cache: options.cache });\n    engine.render(path, options, cb);\n  });\n};\n\n/**\n * ECT string support.\n */\n\nexports.ect.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var ECT = require('ect');\n    var engine = new ECT({ root: { page: str }});\n    engine.render('page', options, cb);\n  });\n};\n\n/**\n * mote support.\n */\n\nexports.mote = fromStringRenderer('mote');\n\n/**\n * mote string support.\n */\n\nexports.mote.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.mote || (requires.mote = require('mote'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Toffee support.\n */\n\nexports.toffee = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var toffee = requires.toffee || (requires.toffee = require('toffee'));\n    toffee.__consolidate_engine_render(path, options, cb);\n  });\n};\n\n/**\n * Toffee string support.\n */\n\nexports.toffee.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.toffee || (requires.toffee = require('toffee'));\n    try {\n      engine.str_render(str, options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * doT support.\n */\n\nexports.dot = fromStringRenderer('dot');\n\n/**\n * doT string support.\n */\n\nexports.dot.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.dot || (requires.dot = require('dot'));\n    var extend = (requires.extend || (requires.extend = require('util')._extend));\n    try {\n      var settings = {};\n      settings = extend(settings, engine.templateSettings);\n      settings = extend(settings, options ? options.dot : {});\n      var tmpl = cache(options) || cache(options, engine.template(str, settings, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * bracket support.\n */\n\nexports.bracket = fromStringRenderer('bracket');\n\n/**\n * bracket string support.\n */\n\nexports.bracket.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.bracket || (requires.bracket = require('bracket-template'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.default.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Ractive support.\n */\n\nexports.ractive = fromStringRenderer('ractive');\n\n/**\n * Ractive string support.\n */\n\nexports.ractive.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var Engine = requires.ractive || (requires.ractive = require('ractive'));\n\n    var template = cache(options) || cache(options, Engine.parse(str));\n    options.template = template;\n\n    if (options.data === null || options.data === undefined) {\n      var extend = (requires.extend || (requires.extend = require('util')._extend));\n\n      // Shallow clone the options object\n      options.data = extend({}, options);\n\n      // Remove consolidate-specific properties from the clone\n      var i;\n      var length;\n      var properties = ['template', 'filename', 'cache', 'partials'];\n      for (i = 0, length = properties.length; i < length; i++) {\n        var property = properties[i];\n        delete options.data[property];\n      }\n    }\n\n    try {\n      cb(null, new Engine(options).toHTML());\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Nunjucks support.\n */\n\nexports.nunjucks = fromStringRenderer('nunjucks');\n\n/**\n * Nunjucks string support.\n */\n\nexports.nunjucks.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n\n    try {\n\n      var engine = options.nunjucksEnv || requires.nunjucks || (requires.nunjucks = require('nunjucks'));\n\n      var env = engine;\n\n      // deprecated fallback support for express\n      // <https://github.com/tj/consolidate.js/pull/152>\n      // <https://github.com/tj/consolidate.js/pull/224>\n      if (options.settings && options.settings.views) {\n        env = engine.configure(options.settings.views);\n      } else if (options.nunjucks && options.nunjucks.configure) {\n        env = engine.configure.apply(engine, options.nunjucks.configure);\n      }\n\n      //\n      // because `renderString` does not initiate loaders\n      // we must manually create a loader for it based off\n      // either `options.settings.views` or `options.nunjucks` or `options.nunjucks.root`\n      //\n      // <https://github.com/mozilla/nunjucks/issues/730>\n      // <https://github.com/crocodilejs/node-email-templates/issues/182>\n      //\n\n      // so instead we simply check if we passed a custom loader\n      // otherwise we create a simple file based loader\n      if (options.loader) {\n        env = new engine.Environment(options.loader);\n      } else if (options.settings && options.settings.views) {\n        env = new engine.Environment(\n          new engine.FileSystemLoader(options.settings.views)\n        );\n      } else if (options.nunjucks && options.nunjucks.loader) {\n        if (typeof options.nunjucks.loader === 'string') {\n          env = new engine.Environment(new engine.FileSystemLoader(options.nunjucks.loader));\n        } else {\n          env = new engine.Environment(\n            new engine.FileSystemLoader(\n              options.nunjucks.loader[0],\n              options.nunjucks.loader[1]\n            )\n          );\n        }\n      }\n\n      env.renderString(str, options, cb);\n    } catch (err) {\n      throw cb(err);\n    }\n  });\n};\n\n/**\n * HTMLing support.\n */\n\nexports.htmling = fromStringRenderer('htmling');\n\n/**\n * HTMLing string support.\n */\n\nexports.htmling.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.htmling || (requires.htmling = require('htmling'));\n    try {\n      var tmpl = cache(options) || cache(options, engine.string(str));\n      cb(null, tmpl.render(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n *  Rendering function\n */\nfunction requireReact(module, filename) {\n  var babel = requires.babel || (requires.babel = require('babel-core'));\n\n  var compiled = babel.transformFileSync(filename, { presets: [ 'react' ] }).code;\n\n  return module._compile(compiled, filename);\n}\n\nexports.requireReact = requireReact;\n\n/**\n *  Converting a string into a node module.\n */\nfunction requireReactString(src, filename) {\n  var babel = requires.babel || (requires.babel = require('babel-core'));\n\n  if (!filename) filename = '';\n  var m = new module.constructor();\n  filename = filename || '';\n\n  // Compile Using React\n  var compiled = babel.transform(src, { presets: [ 'react' ] }).code;\n\n  // Compile as a module\n  m.paths = module.paths;\n  m._compile(compiled, filename);\n\n  return m.exports;\n}\n\n/**\n * A naive helper to replace {{tags}} with options.tags content\n */\nfunction reactBaseTmpl(data, options) {\n\n  var exp;\n  var regex;\n\n  // Iterates through the keys in file object\n  // and interpolate / replace {{key}} with it's value\n  for (var k in options) {\n    if (options.hasOwnProperty(k)) {\n      exp = '{{' + k + '}}';\n      regex = new RegExp(exp, 'g');\n      if (data.match(regex)) {\n        data = data.replace(regex, options[k]);\n      }\n    }\n  }\n\n  return data;\n}\n\n/**\n* Plates Support.\n*/\n\nexports.plates = fromStringRenderer('plates');\n\n/**\n* Plates string support.\n*/\n\nexports.plates.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.plates || (requires.plates = require('plates'));\n    var map = options.map || undefined;\n    try {\n      var tmpl = engine.bind(str, options, map);\n      cb(null, tmpl);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n *  The main render parser for React bsaed templates\n */\nfunction reactRenderer(type) {\n\n  if (require.extensions) {\n\n    // Ensure JSX is transformed on require\n    if (!require.extensions['.jsx']) {\n      require.extensions['.jsx'] = requireReact;\n    }\n\n    // Supporting .react extension as well as test cases\n    // Using .react extension is not recommended.\n    if (!require.extensions['.react']) {\n      require.extensions['.react'] = requireReact;\n    }\n\n  }\n\n  // Return rendering fx\n  return function(str, options, cb) {\n    return promisify(cb, function(cb) {\n      // React Import\n      var ReactDOM = requires.ReactDOM || (requires.ReactDOM = require('react-dom/server'));\n      var react = requires.react || (requires.react = require('react'));\n\n      // Assign HTML Base\n      var base = options.base;\n      delete options.base;\n\n      var enableCache = options.cache;\n      delete options.cache;\n\n      var isNonStatic = options.isNonStatic;\n      delete options.isNonStatic;\n\n      // Start Conversion\n      try {\n\n        var Code;\n        var Factory;\n\n        var baseStr;\n        var content;\n        var parsed;\n\n        if (!cache(options)) {\n          // Parsing\n          if (type === 'path') {\n            var path = resolve(str);\n            delete require.cache[path];\n            Code = require(path);\n          } else {\n            Code = requireReactString(str);\n          }\n          Factory = cache(options, react.createFactory(Code));\n\n        } else {\n          Factory = cache(options);\n        }\n\n        parsed = new Factory(options);\n        content = (isNonStatic) ? ReactDOM.renderToString(parsed) : ReactDOM.renderToStaticMarkup(parsed);\n\n        if (base) {\n          baseStr = readCache[str] || fs.readFileSync(resolve(base), 'utf8');\n\n          if (enableCache) {\n            readCache[str] = baseStr;\n          }\n\n          options.content = content;\n          content = reactBaseTmpl(baseStr, options);\n        }\n\n        cb(null, content);\n\n      } catch (err) {\n        cb(err);\n      }\n    });\n  };\n}\n\n/**\n * React JS Support\n */\nexports.react = reactRenderer('path');\n\n/**\n * React JS string support.\n */\nexports.react.render = reactRenderer('string');\n\n/**\n * ARC-templates support.\n */\n\nexports['arc-templates'] = fromStringRenderer('arc-templates');\n\n/**\n * ARC-templates string support.\n */\n\nexports['arc-templates'].render = function(str, options, cb) {\n  var readFileWithOptions = Promise.promisify(read);\n  var consolidateFileSystem = {};\n  consolidateFileSystem.readFile = function(path) {\n    return readFileWithOptions(path, options);\n  };\n\n  return promisify(cb, function(cb) {\n    try {\n      var engine = requires['arc-templates'];\n      if (!engine) {\n        var Engine = require('arc-templates/dist/es5');\n        engine = requires['arc-templates'] = new Engine({ filesystem: consolidateFileSystem });\n      }\n\n      var compiler = cache(options) || cache(options, engine.compileString(str, options.filename));\n      compiler.then(function(func) { return func(options); })\n        .then(function(result) { cb(null, result.content); })\n        .catch(cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Vash support\n */\nexports.vash = fromStringRenderer('vash');\n\n/**\n * Vash string support\n */\nexports.vash.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.vash || (requires.vash = require('vash'));\n\n    try {\n      // helper system : https://github.com/kirbysayshi/vash#helper-system\n      if (options.helpers) {\n        for (var key in options.helpers) {\n          if (!options.helpers.hasOwnProperty(key) || typeof options.helpers[key] !== 'function') {\n            continue;\n          }\n          engine.helpers[key] = options.helpers[key];\n        }\n      }\n\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      tmpl(options, function sealLayout(err, ctx) {\n        if (err) cb(err);\n        ctx.finishLayout();\n        cb(null, ctx.toString().replace(/\\n$/, ''));\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Slm support.\n */\n\nexports.slm = fromStringRenderer('slm');\n\n/**\n * Slm string support.\n */\n\nexports.slm.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.slm || (requires.slm = require('slm'));\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.compile(str, options));\n      cb(null, tmpl(options));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Marko support.\n */\n\nexports.marko = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.marko || (requires.marko = require('marko'));\n    options.writeToDisk = !!options.cache;\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.load(path, options));\n      tmpl.renderToString(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Marko string support.\n */\n\nexports.marko.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.marko || (requires.marko = require('marko'));\n    options.writeToDisk = !!options.cache;\n    options.filename = options.filename || 'string.marko';\n\n    try {\n      var tmpl = cache(options) || cache(options, engine.load(options.filename, str, options));\n      tmpl.renderToString(options, cb);\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n\n/**\n * Teacup support.\n */\nexports.teacup = function(path, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.teacup || (requires.teacup = require('teacup/lib/express'));\n    require.extensions['.teacup'] = require.extensions['.coffee'];\n    if (path[0] !== '/') {\n      path = join(process.cwd(), path);\n    }\n    if (!options.cache) {\n      var callback = cb;\n      cb = function() {\n        delete require.cache[path];\n        callback.apply(this, arguments);\n      };\n    }\n    engine.renderFile(path, options, cb);\n  });\n};\n\n/**\n * Teacup string support.\n */\nexports.teacup.render = function(str, options, cb) {\n  var coffee = require('coffee-script');\n  var vm = require('vm');\n  var sandbox = {\n    module: {exports: {}},\n    require: require\n  };\n  return promisify(cb, function(cb) {\n    vm.runInNewContext(coffee.compile(str), sandbox);\n    var tmpl = sandbox.module.exports;\n    cb(null, tmpl(options));\n  });\n};\n\n/**\n * Squirrelly support.\n */\n\nexports.squirrelly = fromStringRenderer('squirrelly');\n\n/**\n * Squirrelly string support.\n */\n\nexports.squirrelly.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.squirrelly || (requires.squirrelly = require('squirrelly'));\n    try {\n      for (var partial in options.partials) {\n        engine.definePartial(partial, options.partials[partial]);\n      }\n      for (var helper in options.helpers) {\n        engine.defineHelper(helper, options.helpers[helper]);\n      }\n      var tmpl = cache(options) || cache(options, engine.Compile(str, options));\n      cb(null, tmpl(options, engine));\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * Twing support.\n */\n\nexports.twing = fromStringRenderer('twing');\n\n/**\n * Twing string support.\n */ \n\nexports.twing.render = function(str, options, cb) {\n  return promisify(cb, function(cb) {\n    var engine = requires.twing || (requires.twing = require('twing'));\n    try {\n      new engine.TwingEnvironment(new engine.TwingLoaderNull()).createTemplate(str).then((twingTemplate) => {\n        twingTemplate.render(options).then((rendTmpl) => {\n          var tmpl = cache(options) || cache(options, rendTmpl);\n          cb(null, tmpl);\n        });\n      });\n    } catch (err) {\n      cb(err);\n    }\n  });\n};\n/**\n * expose the instance of the engine\n */\nexports.requires = requires;\n"]},"metadata":{},"sourceType":"script"}